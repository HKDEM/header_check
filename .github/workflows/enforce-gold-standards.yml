name: Enforce Gold Standards

on:
  pull_request:
    branches:
      - main  # This will trigger on PRs to the main branch
      - develop  # You can also include develop or other branches if needed

jobs:

    steps:
      # Step 1: Checkout the code in the PR
      - name: Checkout code
        uses: actions/checkout@v3  # This checks out the pull request code so it can be scanned
     
      # Step 2: Check for High-Risk Dependency Vulnerabilities
      - name: Check for High-Risk Dependency Alerts
        run: |
          dependabot_alerts=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/dependabot/alerts")
          high_risk_alerts=$(echo $dependabot_alerts | jq '. | map(select(.severity == "high")) | length')
          if [ "$high_risk_alerts" -gt 0 ]; then
            echo "Error: Found $high_risk_alerts high-risk dependency alerts. Resolve before merging."
            exit 1  # Stops the PR if high-risk dependencies are found
          fi

      # Step 3: Check Code Coverage (Optional, using Codecov or similar)
      - name: Check Code Coverage
        run: |
          coverage=$(curl -s https://codecov.io/api/v2/project/gh/${{ github.repository }} | jq '.coverage')
          if (( $(echo "$coverage < 80" | bc -l) )); then
            echo "Error: Code coverage is below 80%. Increase before merging."
            exit 1  # Stops the PR if coverage is below threshold
          fi
